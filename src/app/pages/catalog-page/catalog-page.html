<section class="hero">
  <div>
    <p class="eyebrow">Browse</p>
    <h1>Products ready for quoting</h1>
    <p class="lede">
      Search by brand or category, add options to your quote cart, and request pricing.
    </p>
  </div>
  <div class="filters">
    <label class="field">
      <span class="field-label">Search</span>
      <div class="input-shell">
        <input
          type="search"
          placeholder="Search products"
          [ngModel]="searchTerm()"
          (ngModelChange)="searchTerm.set($event)"
        />
        <span class="suffix">üîç</span>
      </div>
    </label>
    <label class="field">
      <span class="field-label">Brand</span>
      <div class="input-shell">
        <select
          [ngModel]="selectedBrand()"
          (ngModelChange)="selectedBrand.set($event)"
          [disabled]="loading()"
        >
          <option value="">All brands</option>
          @if (brands().length) { @for (brand of brands(); track brand) {
          <option [value]="brand">{{ brand }}</option>
          } } @else if (loading()) {
          <option disabled>Loading...</option>
          } @else {
          <option disabled>No brands</option>
          }
        </select>
      </div>
    </label>
    <label class="field">
      <span class="field-label">Category</span>
      <div class="input-shell">
        <select
          [ngModel]="selectedCategory()"
          (ngModelChange)="selectedCategory.set($event)"
          [disabled]="loading()"
        >
          <option value="">All categories</option>
          @if (categories().length) { @for (category of categories(); track category) {
          <option [value]="category">{{ category }}</option>
          } } @else if (loading()) {
          <option disabled>Loading...</option>
          } @else {
          <option disabled>No categories</option>
          }
        </select>
      </div>
    </label>
  </div>
</section>

<section class="grid">
  @for (product of products(); track product.slug) {
  <div class="product-card">
    @if(product.imageUrl){
    <div class="thumb">
      <img [src]="product.imageUrl" [alt]="product.name" loading="lazy" />
    </div>
    }

    <div class="card-header">
      <div>
        <p class="eyebrow">{{ product.brand }} ¬∑ {{ product.category }}</p>
        <h2>{{ product.name }}</h2>
      </div>
      <a class="icon-btn" [routerLink]="['/products', product.slug]" aria-label="View details">‚Üó</a>
    </div>
    <p class="description">{{ product.description }}</p>
    <div class="options">
      @for (option of product.options; track option.label) {
      <div class="option-row" [class.unavailable]="option.available === false">
        <div class="option-meta">
          <div class="option-title">
            <span class="chip-label">{{ option.label }}</span>
            @if (option.available === false) { <span class="chip-sub">Unavailable</span> }
          </div>
          @if (showPrices()) {
          <div class="price-line">
            @if (option.sellingPrice != null) {
            <span class="price">{{ option.sellingPrice | currency }}</span>
            } @else { <span class="price muted">Price not set</span> } @if (option.marketPrice !=
            null && option.marketPrice > (option.sellingPrice ?? 0)) {
            <span class="market">{{ option.marketPrice | currency }}</span>
            } @if (discountPercent(option) !== null) {
            <span class="discount">-{{ discountPercent(option) }}%</span>
            }
          </div>
          @if (showStock() && option.stock != null) {
          <div class="stock-line" [class.low]="isLowStock(option)">
            <span class="stock-count">
              @if (isLowStock(option)) { Low stock: {{ option.stock }} left } @else { In stock:
              {{ option.stock }} }
            </span>
          </div>
          } }
        </div>
        <button
          class="icon-btn add"
          type="button"
          [disabled]="option.available === false || isInCart(product.slug, option.label)"
          (click)="addOptionToQuote(product, option)"
          [title]="isInCart(product.slug, option.label) ? 'Already added' : 'Add to quote'"
        >
          <svg aria-hidden="true" viewBox="0 0 24 24" class="cart-icon">
            <path
              d="M7 4h-2l-1 2h-2v2h2l3.6 7.59-1.35 2.44c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2h-11.42c-.14 0-.25-.11-.25-.25 0-.04.01-.08.03-.11l.9-1.64h7.74c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1h-14.31l-.94-2zm2 16c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm10 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"
            />
          </svg>
        </button>
      </div>
      }
    </div>
    <div class="card-actions">
      <a class="link" [routerLink]="['/products', product.slug]">Details</a>
      <button class="btn ghost" type="button" routerLink="/quote">Go to quote cart</button>
    </div>
  </div>
  }
</section>

<div class="pagination">
  <button class="btn ghost" type="button" (click)="prevPage()" [disabled]="page() === 0">
    Prev
  </button>
  <span class="muted">Page {{ page() + 1 }} of {{ totalPages() }}</span>
  <button
    class="btn ghost"
    type="button"
    (click)="nextPage()"
    [disabled]="page() >= totalPages() - 1"
  >
    Next
  </button>
</div>
